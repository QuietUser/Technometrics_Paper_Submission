conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Bayes Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$max.gamma[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#CUSUM
temp.table <- all.cycles.anomaly.table.cusum
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step CUSUM Approach", "\n","\n")
print(cm_table)
#EWMA
temp.table <- all.cycles.anomaly.table.ewma
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step EWMA Approach", "\n","\n")
print(cm_table)
load("../Water_Filtration_Application/UWTF.elbow.results.Rda")
load("../Water_Filtration_Application/UWTF.AICc.results.Rda")
load("../Water_Filtration_Application/UWTF.Bayes.results.Rda")
load("../Water_Filtration_Application/UWTF.EWMA.results.Rda")
load("../Water_Filtration_Application/UWTF.CUSUM.results.Rda")
library(caret) #confusion tables
anomalies <- c(27,38,76,135,136,170,203,205,227,346,369,383,387,434,446,502,615,657,860,927,1077,1309,1339,1374,1400,1421,1471,1536,1592,1594,1659,1670,1679,1704,1836,1841,1899,1945,2009,2018,2038,2094,2182,2225,2269,2320,2377,2409,2424,2433,2515,2540,2633,2655,2724,2760,2861,2885,2905,2963,2994,3019,3114,3190,3201)
all.cycles.anomaly.table.bayes$Anomalous[!is.na(all.cycles.anomaly.table.bayes$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.bayes$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.freq$Anomalous[!is.na(all.cycles.anomaly.table.freq$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.freq$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.freq.AIC$Anomalous[!is.na(all.cycles.anomaly.table.freq.AIC$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.freq.AIC$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.cusum$Anomalous[!is.na(all.cycles.anomaly.table.cusum$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.cusum$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.ewma$Anomalous[!is.na(all.cycles.anomaly.table.ewma$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.ewma$Anomalous[i] <- "YES"
}
#Frequentist (elbow) - requirement that disturbance is at least threshold
threshold <- .15
temp.table <- all.cycles.anomaly.table.freq
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("Confusion Matrix for Elbow Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Frequentist(AICc) - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.freq.AIC
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for AICc Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Bayesian - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.bayes
temp.table$Identified[temp.table$max.gamma<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Bayes Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$max.gamma[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#CUSUM
temp.table <- all.cycles.anomaly.table.cusum
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step CUSUM Approach", "\n","\n")
print(cm_table)
#EWMA
temp.table <- all.cycles.anomaly.table.ewma
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step EWMA Approach", "\n","\n")
print(cm_table)
missed <- c(76,346,446,3201)
par(mfrow = c(2,2),mar=c(3.5,3.5,3,1),oma=c(1,1,1,1), mgp=c(2.3,.7,0))
for (cn in missed){
cycle.length <- headloss_cycles_info$cycle_length[cn]
# x <- 1:(cycle.length+1)
x <- 1:(cycle.length-5)
n <- length(x)
y <- headloss_matrix[cn,4:(cycle.length-2)]
plot(x,y,ylab="Headloss",xlab="Time Indices",type="l",main=paste0("Cycle ",cn))
}
missed <- c(76,346,502,3201)
par(mfrow = c(2,2),mar=c(3.5,3.5,3,1),oma=c(1,1,1,1), mgp=c(2.3,.7,0))
for (cn in missed){
cycle.length <- headloss_cycles_info$cycle_length[cn]
# x <- 1:(cycle.length+1)
x <- 1:(cycle.length-5)
n <- length(x)
y <- headloss_matrix[cn,4:(cycle.length-2)]
plot(x,y,ylab="Headloss",xlab="Time Indices",type="l",main=paste0("Cycle ",cn))
}
load("../Water_Filtration_Application/UWTF.elbow.results.Rda")
load("../Water_Filtration_Application/UWTF.AICc.results.Rda")
load("../Water_Filtration_Application/UWTF.Bayes.results.Rda")
load("../Water_Filtration_Application/UWTF.EWMA.results.Rda")
load("../Water_Filtration_Application/UWTF.CUSUM.results.Rda")
library(caret) #confusion tables
anomalies <- c(27,38,76,135,136,170,203,205,227,346,369,383,387,434,446,502,615,657,860,927,1077,1309,1339,1374,1400,1421,1471,1536,1592,1594,1659,1670,1679,1704,1836,1841,1899,1945,2009,2018,2038,2094,2182,2225,2269,2320,2377,2409,2424,2433,2515,2540,2633,2655,2724,2760,2861,2885,2905,2963,2994,3019,3114,3190,3201)
all.cycles.anomaly.table.bayes$Anomalous[!is.na(all.cycles.anomaly.table.bayes$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.bayes$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.freq$Anomalous[!is.na(all.cycles.anomaly.table.freq$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.freq$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.freq.AIC$Anomalous[!is.na(all.cycles.anomaly.table.freq.AIC$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.freq.AIC$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.cusum$Anomalous[!is.na(all.cycles.anomaly.table.cusum$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.cusum$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.ewma$Anomalous[!is.na(all.cycles.anomaly.table.ewma$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.ewma$Anomalous[i] <- "YES"
}
###
### Confusion Tables
###
#Frequentist (elbow) - requirement that disturbance is at least threshold
threshold <- .15
temp.table <- all.cycles.anomaly.table.freq
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("Confusion Matrix for Elbow Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Frequentist(AICc) - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.freq.AIC
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for AICc Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Bayesian - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.bayes
temp.table$Identified[temp.table$max.gamma<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Bayes Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$max.gamma[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#CUSUM
temp.table <- all.cycles.anomaly.table.cusum
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step CUSUM Approach", "\n","\n")
print(cm_table)
#EWMA
temp.table <- all.cycles.anomaly.table.ewma
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step EWMA Approach", "\n","\n")
print(cm_table)
missed <- c(76,346,502,3201)
par(mfrow = c(2,2),mar=c(3.5,3.5,3,1),oma=c(1,1,1,1), mgp=c(2.3,.7,0))
for (cn in missed){
cycle.length <- headloss_cycles_info$cycle_length[cn]
# x <- 1:(cycle.length+1)
x <- 1:(cycle.length-5)
n <- length(x)
y <- headloss_matrix[cn,4:(cycle.length-2)]
plot(x,y,ylab="Headloss",xlab="Time Indices",type="l",main=paste0("Cycle ",cn))
}
library(MASS)
cn <- 170
for (cn in c(170,446)){
cycle.length <- headloss_cycles_info$cycle_length[cn]
x <- 1:(cycle.length+1)
n <- length(x)
y <- headloss_matrix[cn,1:(cycle.length+1)]
lambda.grid <- 2^(seq(-6,5,.5))
omega.grid <- 2^(seq(-2,18,.5))
model.bayes <- hybrid.smoother.bayes(x,y,n.chain=1,chain.length=6000, burn.in.percent = 2/3, lambda2.mn0 = .05)
model.freq.aicc <- hybrid.smoother.freq(x,y,lambda.grid,omega.grid,method="AICc",construct.from = "center")
model.freq.elbow <- hybrid.smoother.freq(x,y,lambda.grid,omega.grid,method="elbow",construct.from = "center")
kde <- kde2d(model.bayes$lambda.results,1/model.bayes$phi2.results)
contour(lambda.grid,omega.grid,model.freq.aicc$AICc.info,log="xy",drawlabels=FALSE,xlim=c(lambda.grid[1],5),ylim=c(omega.grid[2],omega.grid[length(omega.grid)-1]),levels=quantile(model.freq.aicc$AICc.info,c(.2,.1,.05,.01)),xlab=bquote(lambda),ylab=bquote(omega),main=paste0("Cycle ",cn))
contour(lambda.grid,omega.grid,matrix(model.freq.elbow$elbow.info$elbow.distance,nrow=length(lambda.grid)),log="xy",levels=quantile(model.freq.elbow$elbow.info$elbow.distance,c(.99,.95,.9,.8)),drawlabels=FALSE,add=TRUE,col="red")
contour(2*kde$x,kde$y,kde$z,add=TRUE, log="xy",col="blue",drawlabels=FALSE,levels=quantile(kde$z,c(.99,.95,.9,.8)))
legend(.28,20, legend = c("Hybrid AICc - AICc Score", "Hybrid Elbow - Elbow Distance", "Bayesian - Kernel Density Estimate"),
col = c("black", "red", "blue"), pch = 19)
points(model.freq.aicc$best.lambda,model.freq.aicc$best.omega,col="black",pch=19)
points(model.freq.elbow$best.lambda,model.freq.elbow$best.omega,col="red",pch=19)
points(2*(kde$x)[row(kde$z)[which.max(kde$z)]],(kde$y)[col(kde$z)[which.max(kde$z)]],col="blue",pch=19)
}
###
### Confusion Tables
###
#Frequentist (elbow) - requirement that disturbance is at least threshold
threshold <- .15
temp.table <- all.cycles.anomaly.table.freq
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("Confusion Matrix for Elbow Approach", "\n","\n")
print(cm_table)
cat("With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Frequentist(AICc) - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.freq.AIC
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for AICc Approach", "\n","\n")
print(cm_table)
cat("With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Bayesian - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.bayes
temp.table$Identified[temp.table$max.gamma<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Bayes Approach", "\n","\n")
print(cm_table)
cat("With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$max.gamma[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#CUSUM
temp.table <- all.cycles.anomaly.table.cusum
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step CUSUM Approach", "\n","\n")
print(cm_table)
#EWMA
temp.table <- all.cycles.anomaly.table.ewma
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step EWMA Approach", "\n","\n")
print(cm_table)
load("../Water_Filtration_Application/UWTF.elbow.results.Rda")
load("../Water_Filtration_Application/UWTF.AICc.results.Rda")
load("../Water_Filtration_Application/UWTF.Bayes.results.Rda")
load("../Water_Filtration_Application/UWTF.EWMA.results.Rda")
load("../Water_Filtration_Application/UWTF.CUSUM.results.Rda")
library(caret) #confusion tables
anomalies <- c(27,38,76,135,136,170,203,205,227,346,369,383,387,434,446,502,615,657,860,927,1077,1309,1339,1374,1400,1421,1471,1536,1592,1594,1659,1670,1679,1704,1836,1841,1899,1945,2009,2018,2038,2094,2182,2225,2269,2320,2377,2409,2424,2433,2515,2540,2633,2655,2724,2760,2861,2885,2905,2963,2994,3019,3114,3190,3201)
all.cycles.anomaly.table.bayes$Anomalous[!is.na(all.cycles.anomaly.table.bayes$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.bayes$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.freq$Anomalous[!is.na(all.cycles.anomaly.table.freq$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.freq$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.freq.AIC$Anomalous[!is.na(all.cycles.anomaly.table.freq.AIC$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.freq.AIC$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.cusum$Anomalous[!is.na(all.cycles.anomaly.table.cusum$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.cusum$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.ewma$Anomalous[!is.na(all.cycles.anomaly.table.ewma$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.ewma$Anomalous[i] <- "YES"
}
###
### Confusion Tables
###
#Frequentist (elbow) - requirement that disturbance is at least threshold
threshold <- .15
temp.table <- all.cycles.anomaly.table.freq
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("Confusion Matrix for Elbow Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Frequentist(AICc) - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.freq.AIC
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for AICc Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Bayesian - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.bayes
temp.table$Identified[temp.table$max.gamma<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Bayes Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$max.gamma[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#CUSUM
temp.table <- all.cycles.anomaly.table.cusum
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step CUSUM Approach", "\n","\n")
print(cm_table)
#EWMA
temp.table <- all.cycles.anomaly.table.ewma
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step EWMA Approach", "\n","\n")
print(cm_table)
threshold <- .0
temp.table <- all.cycles.anomaly.table.freq
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("Confusion Matrix for Elbow Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Frequentist(AICc) - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.freq.AIC
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for AICc Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Bayesian - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.bayes
temp.table$Identified[temp.table$max.gamma<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Bayes Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$max.gamma[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#CUSUM
temp.table <- all.cycles.anomaly.table.cusum
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step CUSUM Approach", "\n","\n")
print(cm_table)
#EWMA
temp.table <- all.cycles.anomaly.table.ewma
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step EWMA Approach", "\n","\n")
print(cm_table)
load("../Water_Filtration_Application/UWTF.elbow.results.Rda")
load("../Water_Filtration_Application/UWTF.AICc.results.Rda")
load("../Water_Filtration_Application/UWTF.Bayes.results.Rda")
load("../Water_Filtration_Application/UWTF.EWMA.results.Rda")
load("../Water_Filtration_Application/UWTF.CUSUM.results.Rda")
library(caret) #confusion tables
anomalies <- c(27,38,76,135,136,170,203,205,227,346,369,383,387,434,446,502,615,657,860,927,1077,1309,1339,1374,1400,1421,1471,1536,1592,1594,1659,1670,1679,1704,1836,1841,1899,1945,2009,2018,2038,2094,2182,2225,2269,2320,2377,2409,2424,2433,2515,2540,2633,2655,2724,2760,2861,2885,2905,2963,2994,3019,3114,3190,3201)
all.cycles.anomaly.table.bayes$Anomalous[!is.na(all.cycles.anomaly.table.bayes$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.bayes$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.freq$Anomalous[!is.na(all.cycles.anomaly.table.freq$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.freq$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.freq.AIC$Anomalous[!is.na(all.cycles.anomaly.table.freq.AIC$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.freq.AIC$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.cusum$Anomalous[!is.na(all.cycles.anomaly.table.cusum$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.cusum$Anomalous[i] <- "YES"
}
all.cycles.anomaly.table.ewma$Anomalous[!is.na(all.cycles.anomaly.table.ewma$Identified)]<-"NO"
for (i in anomalies){
all.cycles.anomaly.table.ewma$Anomalous[i] <- "YES"
}
###
### Confusion Tables
###
#Frequentist (elbow) - requirement that disturbance is at least threshold
threshold <- .15
temp.table <- all.cycles.anomaly.table.freq
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("Confusion Matrix for Elbow Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Frequentist(AICc) - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.freq.AIC
temp.table$Identified[temp.table$Max.CP<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for AICc Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$Max.CP[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#Bayesian - requirement that disturbance is at least threshold
temp.table <- all.cycles.anomaly.table.bayes
temp.table$Identified[temp.table$max.gamma<threshold] <- "NO"
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Bayes Approach", "\n","\n")
print(cm_table)
cat("\n","With identified cycles below the threshold at:","\n")
df=data.frame(MissedCycles = which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES"), MaxChangepointValue = round(temp.table$max.gamma[which(temp.table$Identified=="NO" & temp.table$Anomalous=="YES")],2))
cat(apply(df, 1, paste, collapse = "\t"), sep = "\n")
#CUSUM
temp.table <- all.cycles.anomaly.table.cusum
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step CUSUM Approach", "\n","\n")
print(cm_table)
#EWMA
temp.table <- all.cycles.anomaly.table.ewma
predicted <- as.factor(temp.table$Identified[!is.na(temp.table$Identified)])
expected <- as.factor(temp.table$Anomalous[!is.na(temp.table$Identified)])
conf_matrix <- confusionMatrix(predicted,expected)
cm_table <- conf_matrix$table
cat("\n","Confusion Matrix for Two-Step EWMA Approach", "\n","\n")
print(cm_table)
